import{LikeC4Model as U}from"@likec4/core/model";import{useRef as _,useCallback as x,useSyncExternalStore as R,useState as A,useEffect as V}from"react";import{t as L}from"../shared/likec4.DO_7oUns.mjs";import{a as C}from"../shared/likec4.DOUP9ptn.mjs";let T=Symbol("clean"),o=[],a=0;const m=4;let g=0;const M=e=>{let n=[],t={get(){return t.lc||t.listen(()=>{})(),t.value},lc:0,listen(l){return t.lc=n.push(l),()=>{for(let u=a+m;u<o.length;)o[u]===l?o.splice(u,m):u+=m;let i=n.indexOf(l);~i&&(n.splice(
i,1),--t.lc||t.off())}},notify(l,i){g++;let u=!o.length;for(let r of n)o.push(r,t.value,l,i);if(u){for(a=0;a<o.length;a+=m)o[a](o[a+1],o[a+2],o[a+3]);o.length=0}},off(){},set(l){let i=t.value;i!==l&&(t.value=l,t.notify(i))},subscribe(l){let i=t.listen(l);return l(t.value),i},value:e};return process.env.NODE_ENV!=="production"&&(t[T]=()=>{n=[],t.lc=0,t.off()}),t},I=5,v=6,E=10;let D=(e,n,t,l)=>(e.events=e.events||{},e.events[t+E]||(e.events[t+E]=l(i=>{e.events[t].reduceRight((u,r)=>(r(u),u),{shared:{},
...i})})),e.events[t]=e.events[t]||[],e.events[t].push(n),()=>{let i=e.events[t],u=i.indexOf(n);i.splice(u,1),i.length||(delete e.events[t],e.events[t+E](),delete e.events[t+E])}),Q=1e3,b=(e,n)=>D(e,l=>{let i=n(l);i&&e.events[v].push(i)},I,l=>{let i=e.listen;e.listen=(...r)=>(!e.lc&&!e.active&&(e.active=!0,l()),i(...r));let u=e.off;if(e.events[v]=[],e.off=()=>{u(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let r of e.events[v])r();e.events[v]=[]}},Q)},process.env.NODE_ENV!=="production"){
let r=e[T];e[T]=()=>{for(let f of e.events[v])f();e.events[v]=[],e.active=!1,r()}}return()=>{e.listen=i,e.off=u}}),w=(e,n,t)=>{Array.isArray(e)||(e=[e]);let l,i,u=()=>{if(i===g)return;i=g;let c=e.map(s=>s.get());if(!l||c.some((s,h)=>s!==l[h])){l=c;let s=n(...c);s&&s.then&&s.t?s.then(h=>{l===c&&r.set(h)}):(r.set(s),i=g)}},r=M(void 0),f=r.get;r.get=()=>(u(),f());let d,p=t?()=>{clearTimeout(d),d=setTimeout(u)}:u;return b(r,()=>{let c=e.map(s=>s.listen(p));return u(),()=>{for(let s of c)s()}}),r};const N=(e,n)=>w(
e,n),k=(e,n)=>w(e,n,!0);function q(e,n,t){let l=new Set(n).add(void 0);return e.listen((i,u,r)=>{l.has(r)&&t(i,u,r)})}const F=(e={})=>{let n=M(e);return n.setKey=function(t,l){let i=n.value;typeof l>"u"&&t in n.value?(n.value={...n.value},delete n.value[t],n.notify(i,t)):n.value[t]!==l&&(n.value={...n.value,[t]:l},n.notify(i,t))},n};let O=(e,n)=>t=>{e.current!==t&&(e.current=t,n())};function S(e,{keys:n,deps:t=[e,n]}={}){let l=_();l.current=e.get();let i=x(r=>(O(l,r)(e.value),n?.length>0?q(e,n,O(
l,r)):e.listen(O(l,r))),t),u=()=>l.current;return R(i,u,u)}const H=e=>{const n=N(e,f=>U.create(f));function t(f){const d=e.get();if(L(d,f))return;const p={...f,views:C(f.views,c=>{const s=d.views[c.id];return L(s,c)?s:c})};e.set(p)}const l=N(e,f=>Object.values(f.views));function i(){return S(n)}function u(){return S(l)}function r(f){const[d,p]=A(e.value?.views[f]??null);return V(()=>e.subscribe(c=>{p(c.views[f]??null)}),[f]),d}return{updateModel:t,$likec4model:n,useLikeC4Model:i,useLikeC4Views:u,
useLikeC4View:r}};export{M as atom,k as batched,N as computed,H as createHooksForModel,F as map,S as useStore};
